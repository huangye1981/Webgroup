app.config(["$routeProvider",function(a){a.when("/start",{templateUrl:"/static/page/app/domain_list.html",controller:"FilesListCtrl"}),a.when("/files/list",{templateUrl:"/static/page/app/files_list.html",controller:"FilesListCtrl"}),a.when("/domain/list",{templateUrl:"/static/page/app/domain_list.html",controller:"DomainListCtrl"})}]),app.controller("DomainEditCtrl",["$scope","$http","$filter","$modalInstance","curr_data","appCfg",function(a,b,c,d,e,f){a.cancel=function(){d.dismiss("cancel")},a.reset=function(){a.editData=angular.copy(a.oldData)},a.change=function(b){if(0==b.length){for(var b in a.editData){if(!a.oldData.hasOwnProperty(b))return!0;if(a.oldData[b]!=a.editData[b])return!0}return!1}return!a.oldData.hasOwnProperty(b)||a.oldData[b]!=a.editData[b]},a.save=function(){b.post(a.postUrl,a.editData).success(function(a,b,e,f){c("CheckError")(a)&&d.close(a)})},a.attrDef=[{Key:"Domain",Title:"域名",InputType:"text",Required:"true"},{Key:"Sort",Title:"排序",InputType:"text-i",Required:"true",Min:1,Max:100},{Key:"Note",Title:"备注",InputType:"textarea",Required:"false"}],a.title="添加域名",a.op=angular.copy(e.Op),a.oldData=angular.copy(e.Data),a.editData=angular.copy(a.oldData),a.postUrl=f.AppPrefix+"/domain/add","edit"==e.Op&&(a.title="编辑域名",a.postUrl=f.AppPrefix+"/domain/edit")}]),app.controller("DomainListCtrl",["$scope","$http","$filter","$modal","EzConfirm","appCfg","configService",function(a,b,c,d,e,f,g){a.config=g.data,a.search={PageSize:10,Page:1,Keyword:"",Status:0},a.getList=function(){var d=f.AppPrefix+"/domain/list";b.post(d,a.search).success(function(b,d,e,f){c("CheckError")(b)&&(a.listData=b.Data)})};var h;a.add=function(){h=d.open({backdrop:!1,templateUrl:"/static/page/modal/base.html",controller:"DomainEditCtrl",resolve:{curr_data:function(){return{Op:"add",Data:{Sort:100}}}}}),h.result.then(function(b){a.getList()})},a.edit=function(e){var g=f.AppPrefix+"/domain/edit/"+e;b.get(g).success(function(b,e,f,g){c("CheckError")(b)&&(h=d.open({backdrop:!1,templateUrl:"/static/page/modal/base.html",controller:"DomainEditCtrl",resolve:{curr_data:function(){return{Op:"edit",Data:b.Data}}}}),h.result.then(function(b){a.getList()}))})},a.del=function(d){e.create({heading:"域名删除",text:"确定删除域名“"+d.Name+"“吗？"}).then(function(){var e=angular.copy(d),g=f.AppPrefix+"/domain/del";b.post(g,e).success(function(b,d,e,f){c("CheckError")(b)&&(a.getList(),storeService.getList())})})},a.getList()}]),app.controller("FilesEditCtrl",["$scope","$http","$filter","$modalInstance","curr_data","appCfg",function(a,b,c,d,e,f){a.cancel=function(){d.dismiss("cancel")},a.reset=function(){a.editData=angular.copy(a.oldData)},a.loading=!1,a.change=function(b){if(a.loading)return!1;if(0==b.length){for(var b in a.editData){if(!a.oldData.hasOwnProperty(b))return!0;if(a.oldData[b]!=a.editData[b])return!0}return!1}return!a.oldData.hasOwnProperty(b)||a.oldData[b]!=a.editData[b]},a.dataUrl="",a.save=function(){a.loading=!0,$("#ihtml img").each(function(){this.src="/admin/public/getimg?Imgsrc="+this.src});var e=document.getElementById("ihtml");domtoimage.toPng(e).then(function(e){a.editData.Photo=e,a.dataUrl=e,b.post(a.postUrl,a.editData).success(function(a,b,e,f){c("CheckError")(a)&&d.close(a)})}).catch(function(a){console.error("oops, something went wrong!",a)})},a.iframeLoadedCallBack=function(){console.log(88888888888),$("#ihtml")[0].contentWindow.createImg()},a.save2=function(){a.loading=!0;var b=document.getElementById("ihtml").contentDocument||document.frames.ihtml.document;b.body.innerHTML=a.editData.Content},a._simpleConfig={toolbars:[["source","|","undo","redo","|","bold","italic","underline","fontborder","strikethrough","removeformat","|","forecolor","backcolor","|","insertorderedlist","insertunorderedlist","|","customstyle","paragraph","fontfamily","fontsize","lineheight","justifyleft","justifycenter","justifyright","justifyjustify","|","touppercase","tolowercase","|","link","unlink","anchor","|","imagenone","imageleft","imageright","imagecenter","|","simpleupload","insertimage","emotion","scrawl","pagebreak","template","background","|","horizontal","date","time","spechars","snapscreen","wordimage","|","inserttable","deletetable","insertparagraphbeforetable","insertrow","deleterow","insertcol","deletecol","mergecells","mergeright","mergedown","splittocells","splittorows","splittocols","charts","|","selectall","cleardoc","preview"]],initialFrameWidth:"100%",initialFrameHeight:320,autoClearinitialContent:!0,wordCount:!1,elementPathEnabled:!1},a.attrDef=[{Key:"Title",Title:"标题",InputType:"text",Required:"true"},{Key:"Keywords",Title:"关键字",InputType:"text",Required:"false"},{Key:"Description",Title:"简介",InputType:"text",Required:"false"},{Key:"Href",Title:"跳转",InputType:"text",Required:"true"},{Key:"Content",Title:"内容",InputType:"ueditor",Required:"false",Config:a._simpleConfig},{Key:"Note",Title:"备注",InputType:"textarea",Required:"false"},{Key:"Sort",Title:"排序",InputType:"text-i",Required:"true",Min:1,Max:100}],a.title="添加软文",a.op=angular.copy(e.Op),a.oldData=angular.copy(e.Data),a.editData=angular.copy(a.oldData),a.postUrl=f.AppPrefix+"/files/add","edit"==e.Op&&(a.title="编辑软文",a.postUrl=f.AppPrefix+"/files/edit")}]),app.controller("FilesListCtrl",["$scope","$http","$filter","$modal","EzConfirm","appCfg","configService",function(a,b,c,d,e,f,g){a.config=g.data,a.search={PageSize:10,Page:1,Keyword:"",Status:0},a.getList=function(){var d=f.AppPrefix+"/files/list";b.post(d,a.search).success(function(b,d,e,f){c("CheckError")(b)&&(a.listData=b.Data)})};var h;a.add=function(){h=d.open({size:"lg",backdrop:!1,templateUrl:"/static/page/modal/files_edit.html",controller:"FilesEditCtrl",resolve:{curr_data:function(){return{Op:"add",Data:{Sort:100}}}}}),h.result.then(function(b){a.getList()})},a.edit=function(e){var g=f.AppPrefix+"/files/edit/"+e;b.get(g).success(function(b,e,f,g){c("CheckError")(b)&&(h=d.open({size:"lg",backdrop:!1,templateUrl:"/static/page/modal/files_edit.html",controller:"FilesEditCtrl",resolve:{curr_data:function(){return{Op:"edit",Data:b.Data}}}}),h.result.then(function(b){a.getList()}))})},a.del=function(d){e.create({heading:"软文删除",text:"确定删除该软文吗？"}).then(function(){var e=angular.copy(d),g=f.AppPrefix+"/files/del";b.post(g,e).success(function(b,d,e,f){c("CheckError")(b)&&(a.getList(),storeService.getList())})})},a.getList()}]),app.directive("flotChart",[function(){return{restrict:"A",scope:{data:"=",options:"="},link:function(a,b){var c,d,e;return c=a.data,d=a.options,e=$.plot(b[0],c,d)}}}]),app.directive("flotChartRealtime",[function(){return{restrict:"A",link:function(a,b){var c,d,e,f,g,h;return c=[],f=500,d=function(){var a,b,d,e;for(c.length>0&&(c=c.slice(1));c.length<f;)b=c.length>0?c[c.length-1]:50,e=b+10*Math.random()-5,0>e?e=0:e>100&&(e=100),c.push(e);for(d=[],a=0;a<c.length;)d.push([a,c[a]]),++a;return d},g=function(){e.setData([d()]),e.draw(),setTimeout(g,h)},c=[],f=500,h=200,e=$.plot(b[0],[d()],{series:{lines:{show:!0,fill:!1},shadowSize:0},yaxis:{min:0,max:100},xaxis:{show:!1},grid:{hoverable:!0,borderWidth:1,borderColor:"#eeeeee"},colors:["#70b1cf"]}),g()}}}]),app.directive("iframeOnload",[function(){return{scope:{callBack:"&iframeOnload"},link:function(a,b,c){b.on("load",function(){return a.callBack()})}}}]),app.directive("morrisChart",[function(){return{restrict:"A",scope:{data:"=",type:"=",options:"="},link:function(a,b){var c,d,e,f;switch(c=a.data,f=a.type){case"line":return e=angular.extend({element:b[0],data:c},a.options),new Morris.Line(e);case"area":return e=angular.extend({element:b[0],data:c},a.options),new Morris.Area(e);case"bar":return e=angular.extend({element:b[0],data:c},a.options),new Morris.Bar(e);case"donut":return e=angular.extend({element:b[0],data:c},a.options),e.formatter&&(d=new Function("y","data",e.formatter),e.formatter=d),new Morris.Donut(e)}}}}]),app.directive("sparkline",[function(){return{restrict:"A",scope:{data:"=",options:"="},link:function(a,b){var c,d,e;return c=a.data,d=a.options,e=function(){return b.sparkline(c,d)},$(window).resize(function(){var a;return clearTimeout(a),a=setTimeout(e,200)}),e()}}}]),app.directive("zyupload",["$rootScope",function(a){return{restrict:"E",template:'<div id="zyupload" class="zyupload"></div>',link:function(b,c,d){$("#zyupload").zyUpload({width:"100%",height:"100%",itemWidth:"100px",itemHeight:"80px",url:"/admin/album/add",fileType:["jpg","png"],fileSize:512e5,multiple:!0,dragDrop:!1,tailor:!1,del:!0,finishDel:!0,onSelect:function(a,b){console.info("当前选择了以下文件："),console.info(a),console.info("之前没上传的文件："),console.info(b)},onDelete:function(a,b){console.info("当前删除了此文件："),console.info(a),console.info("当前剩余的文件："),console.info(b)},onSuccess:function(b,c){a.$broadcast("uploadSuccess",c),console.info("此文件上传成功："),console.info(b)},onFailure:function(a){console.info("此文件上传失败："),console.info(a)},onComplete:function(b){a.$broadcast("uploadComplete",b),console.info("文件上传完成"),console.info(b)}})}}}]),app.filter("arrayAttr",[function(){return function(a,b,c){for(var d=0;d<b.length;d++)if(b[d].Id==a)return b[d][c];return"无"}}]),app.filter("FileSize",[function(){return function(a){if(0===a)return"0 B";var b=1024;return sizes=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],i=Math.floor(Math.log(a)/Math.log(b)),(a/Math.pow(b,i)).toPrecision(3)+" "+sizes[i]}}]),app.filter("Tohtml",["$sce",function(a){return function(b){return b=b||"",a.trustAsHtml(b)}}]),app.service("categoryService",["$rootScope","$http","$filter","appCfg",function(a,b,c,d){var e=this;this.data={Items:[]},this.getList=function(){var a=d.AppPrefix+"/apppub/category";b.get(a).success(function(a,b,d,f){c("CheckError")(a)&&(e.data.Items=a.Data)}).error(function(a,b,c,d){})},this.getList()}]),app.service("typeService",["$rootScope","$http","$filter","appCfg",function(a,b,c,d){var e=this;this.data={Items:[]},this.getList=function(){var a=d.AppPrefix+"/apppub/type";b.get(a).success(function(a,b,d,f){c("CheckError")(a)&&(e.data.Items=a.Data)}).error(function(a,b,c,d){})},this.getList()}]);